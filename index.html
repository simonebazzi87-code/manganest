<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MangaNest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--main:#6c5ce7;--bg:#f5f6fa;}
body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);}
header{background:var(--main);color:#fff;padding:12px;display:flex;justify-content:space-between;align-items:center;}
nav{display:flex;gap:8px;padding:10px;background:#fff;flex-wrap:wrap;}
nav button{height:42px;border:none;border-radius:6px;padding:0 16px;cursor:pointer;}
main{padding:12px;}
.card{background:#fff;border-radius:8px;padding:12px;margin-bottom:12px;}
.volumes{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;}
.volume{padding:6px 10px;border-radius:6px;background:#eee;}
select,input{width:100%;padding:6px;margin:6px 0;}
.debug{background:#ffeb3b;padding:10px;font-weight:bold;margin-bottom:10px;}
</style>
</head>
<body>

<header>
  <div>
    <h1 style="margin:0">MangaNest</h1>
    <div id="who"></div>
  </div>
  <button id="switchUser" style="display:none">Cambia utente</button>
</header>

<nav id="menu"></nav>
<main id="app"></main>

<script>
let db = JSON.parse(localStorage.getItem("manganest")) || {
  users:[
    {id:"simone",name:"Simone",color:"#6c5ce7"},
    {id:"andrea",name:"Andrea",color:"#e84393"}
  ],
  currentUser:null,
  sagas:[],
  series:[],
  volumes:[]
};

function save(){ localStorage.setItem("manganest",JSON.stringify(db)); }

const app=document.getElementById("app");
const menu=document.getElementById("menu");
const who=document.getElementById("who");
const switchBtn=document.getElementById("switchUser");

switchBtn.onclick=()=>{ db.currentUser=null; render(); };

function render(){
  const user=db.users.find(u=>u.id===db.currentUser);
  document.documentElement.style.setProperty("--main", user?.color || "#6c5ce7");
  who.textContent=user ? "Utente: "+user.name : "";
  switchBtn.style.display=user?"inline-block":"none";

  menu.innerHTML="";
  if(!db.currentUser){ home(); return; }

  [
    ["Database",database],
    ["Aggiungi numeri",addVolumes],
    ["Utenti",users],
    ["Lettura",reading]
  ].forEach(([t,f])=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.onclick=()=>f(app);
    menu.appendChild(b);
  });

  database(app);
}

function home(){
  app.innerHTML="<h2>Scegli utente</h2>";
  db.users.sort((a,b)=>a.name.localeCompare(b.name)).forEach(u=>{
    const b=document.createElement("button");
    b.textContent=u.name;
    b.style.background=u.color;
    b.style.color="#fff";
    b.style.margin="6px";
    b.onclick=()=>{ db.currentUser=u.id; save(); render(); };
    app.appendChild(b);
  });
}

/* ------------------ SEZIONE LETTURA (DEBUG) ------------------ */
function reading(c){
  c.innerHTML=`
    <div class="debug">ðŸš§ LETTURA â€“ STEP 1 (DEBUG OK)</div>

    <div class="card">
      <label>Saga</label>
      <select id="sagaSel">
        <option value="">-- Tutte le saghe --</option>
        ${db.sagas.sort((a,b)=>a.name.localeCompare(b.name))
          .map(s=>`<option value="${s.id}">${s.name}</option>`).join("")}
      </select>

      <label>Serie</label>
      <select id="seriesSel">
        <option value="">-- Seleziona serie --</option>
      </select>

      <div id="result"></div>
    </div>
  `;

  const sagaSel=document.getElementById("sagaSel");
  const seriesSel=document.getElementById("seriesSel");
  const result=document.getElementById("result");

  function refreshSeries(){
    let list=db.series;
    if(sagaSel.value) list=list.filter(s=>s.sagaId===sagaSel.value);
    seriesSel.innerHTML=
      `<option value="">-- Seleziona serie --</option>`+
      list.sort((a,b)=>a.name.localeCompare(b.name))
          .map(s=>`<option value="${s.id}">${s.name}</option>`).join("");
    result.innerHTML="";
  }

  function showVolumes(){
    result.innerHTML="";
    if(!seriesSel.value) return;
    const vols=db.volumes
      .filter(v=>v.series===seriesSel.value)
      .sort((a,b)=>a.number-b.number);
    const box=document.createElement("div");
    box.className="volumes";
    vols.forEach(v=>{
      const d=document.createElement("div");
      d.className="volume";
      d.textContent=v.number;
      box.appendChild(d);
    });
    result.appendChild(box);
  }

  sagaSel.onchange=refreshSeries;
  seriesSel.onchange=showVolumes;

  refreshSeries();
}

function database(c){ c.innerHTML="<p>Database (non modificato)</p>"; }
function addVolumes(c){ c.innerHTML="<p>Aggiungi numeri (non modificato)</p>"; }
function users(c){ c.innerHTML="<p>Utenti (non modificato)</p>"; }

render();
</script>
</body>
</html>
